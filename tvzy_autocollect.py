#!/usr/bin/envpython3#tvzy_autocollect.pyimportrequestsimportreimportjsonfromdatetimeimportdatetimeimporttimeimportosimportrandomfromurllib.parseimporturlparseclassTVSourceCollector:def__init__(self):self.sources=[]#频道分组定义self.channel_categories={"4K":['CCTV4K','CCTV164K','北京卫视4K','北京IPTV4K','湖南卫视4K','山东卫视4K','广东卫视4K','四川卫视4K','浙江卫视4K','江苏卫视4K','东方卫视4K','深圳卫视4K','河北卫视4K','峨眉电影4K','求索4K','咪视界4K','欢笑剧场4K','苏州4K','至臻视界4K','南国都市4K','翡翠台4K','百事通电影4K','百事通少儿4K','百事通纪实4K','华数爱上4K'],"央视":['CCTV1','CCTV2','CCTV3','CCTV4','CCTV4欧洲','CCTV4美洲','CCTV5','CCTV5+','CCTV6','CCTV7','CCTV8','CCTV9','CCTV10','CCTV11','CCTV12','CCTV13','CCTV14','CCTV15','CCTV16','CCTV17','兵器科技','风云音乐','风云足球','风云剧场','怀旧剧场','第一剧场','女性时尚','世界地理','央视台球','高尔夫网球','央视文化精品','北京纪实科教','卫生健康','电视指南'],"卫视":['山东卫视','浙江卫视','江苏卫视','东方卫视','深圳卫视','北京卫视','广东卫视','广西卫视','东南卫视','海南卫视','河北卫视','河南卫视','湖北卫视','江西卫视','四川卫视','重庆卫视','贵州卫视','云南卫视','天津卫视','安徽卫视','湖南卫视','辽宁卫视','黑龙江卫视','吉林卫视','内蒙古卫视','宁夏卫视','山西卫视','陕西卫视','甘肃卫视','青海卫视','新疆卫视','西藏卫视','三沙卫视','厦门卫视','兵团卫视','延边卫视','安多卫视','康巴卫视','农林卫视','山东教育','CETV1','CETV2','CETV3','CETV4','早期教育'],"北京专属":['北京卫视','北京财经','北京纪实','北京生活','北京体育休闲','北京国际','北京文艺','北京新闻','北京淘电影','北京淘剧场','北京淘4K','北京淘娱乐','北京淘BABY','北京萌宠TV'],"山东专属":['山东卫视','山东齐鲁','山东综艺','山东少儿','山东生活','山东新闻','山东国际','山东体育','山东文旅','山东农科'],"港澳台":['凤凰中文','凤凰资讯','凤凰香港','凤凰电影'],"影视剧":['CHC动作电影','CHC家庭影院','CHC影迷电影','淘电影','淘精彩','淘剧场','星空卫视','黑莓电影','东北热剧','中国功夫','动作电影','超级电影'],"音乐":['动漫秀场','哒啵电竞','黑莓动画','卡酷少儿','金鹰卡通','优漫卡通','哈哈炫动','嘉佳卡通'],"体育":['iHOT爱喜剧','iHOT爱科幻','iHOT爱院线','iHOT爱悬疑','iHOT爱历史','iHOT爱谍战','iHOT爱旅行','iHOT爱幼教','iHOT爱玩具','iHOT爱体育','iHOT爱赛车','iHOT爱浪漫','iHOT爱奇谈','iHOT爱科学','iHOT爱动漫'],"综合":['重温经典','CHANNEL[V]','求索纪录','求索科学','求索生活','求索动物','睛彩青少','睛彩竞技','睛彩篮球','睛彩广场舞','金鹰纪实','快乐垂钓','茶频道','军事评论','军旅剧场','乐游','生活时尚','都市剧场','欢笑剧场','游戏风云','金色学堂','法治天地','哒啵赛事'],"剧场":['天元围棋','魅力足球','五星体育','劲爆体育','超级体育'],"其他":['古装剧场','家庭剧场','惊悚悬疑','明星大片','欢乐剧场','海外剧场','潮妈辣婆','爱情喜剧','超级电视剧','超级综艺','金牌综艺','武搏世界','农业致富','炫舞未来','精品体育','精品大剧','精品纪录','精品萌宠','怡伴健康'],}#频道别名映射self.channel_mapping={#4K频道"CCTV4K":["CCTV4K","CCTV-4K"],"CCTV164K":["CCTV164K","CCTV16-4K","CCTV16奥林匹克4K","CCTV16奥林匹克4K"],"北京卫视4K":["北京卫视4K","北京卫视-4K"],"北京IPTV4K":["北京IPTV4K","北京IPTV-4K"],"湖南卫视4K":["湖南卫视4K","湖南卫视-4K"],"山东卫视4K":["山东卫视4K","山东卫视-4K"],"广东卫视4K":["广东卫视4K","广东卫视-4K"],"四川卫视4K":["四川卫视4K","四川卫视-4K"],"浙江卫视4K":["浙江卫视4K","浙江卫视-4K"],"江苏卫视4K":["江苏卫视4K","江苏卫视-4K"],"东方卫视4K":["东方卫视4K","东方卫视-4K"],"深圳卫视4K":["深圳卫视4K","深圳卫视-4K"],"河北卫视4K":["河北卫视4K","河北卫视-4K"],"峨眉电影4K":["峨眉电影4K","峨眉电影-4K"],"求索4K":["求索4K","求索-4K"],"咪视界4K":["咪视界4K","咪视界-4K"],"欢笑剧场4K":["欢笑剧场4K","欢笑剧场-4K"],"苏州4K":["苏州4K","苏州-4K"],"至臻视界4K":["至臻视界4K","至臻视界-4K"],"南国都市4K":["南国都市4K","南国都市-4K"],"翡翠台4K":["翡翠台4K","翡翠台-4K"],"百事通电影4K":["百事通电影4K","百事通电影-4K"],"百事通少儿4K":["百事通少儿4K","百事通少儿-4K"],"百事通纪实4K":["百事通纪实4K","百事通纪实-4K"],"华数爱上4K":["华数爱上4K","爱上4K","爱上4K","爱上-4K","华数爱上-4K"],#央视频道"CCTV1":["CCTV-1","CCTV-1HD","CCTV1综合","CCTV-1综合"],"CCTV2":["CCTV-2","CCTV-2HD","CCTV2财经","CCTV-2财经"],"CCTV3":["CCTV-3","CCTV-3HD","CCTV3综艺","CCTV-3综艺"],"CCTV4":["CCTV-4","CCTV-4HD","CCTV4a","CCTV4A","CCTV4中文国际","CCTV-4中文国际"],"CCTV4欧洲":["CCTV-4欧洲","CCTV-4欧洲HD","CCTV-4欧洲","CCTV4o","CCTV4O","CCTV-4中文欧洲","CCTV4中文欧洲"],"CCTV4美洲":["CCTV-4美洲","CCTV-4美洲HD","CCTV-4美洲","CCTV4m","CCTV4M","CCTV-4中文美洲","CCTV4中文美洲"],"CCTV5":["CCTV-5","CCTV-5HD","CCTV5体育","CCTV-5体育"],"CCTV5+":["CCTV-5+","CCTV-5+HD","CCTV5+体育赛事","CCTV-5+体育赛事"],"CCTV6":["CCTV-6","CCTV-6HD","CCTV6电影","CCTV-6电影"],"CCTV7":["CCTV-7","CCTV-7HD","CCTV7国防军事","CCTV-7国防军事"],"CCTV8":["CCTV-8","CCTV-8HD","CCTV8电视剧","CCTV-8电视剧"],"CCTV9":["CCTV-9","CCTV-9HD","CCTV9纪录","CCTV-9纪录"],"CCTV10":["CCTV-10","CCTV-10HD","CCTV10科教","CCTV-10科教"],"CCTV11":["CCTV-11","CCTV-11HD","CCTV11戏曲","CCTV-11戏曲"],"CCTV12":["CCTV-12","CCTV-12HD","CCTV12社会与法","CCTV-12社会与法"],"CCTV13":["CCTV-13","CCTV-13HD","CCTV13新闻","CCTV-13新闻"],"CCTV14":["CCTV-14","CCTV-14HD","CCTV14少儿","CCTV-14少儿"],"CCTV15":["CCTV-15","CCTV-15HD","CCTV15音乐","CCTV-15音乐"],"CCTV16":["CCTV-16","CCTV-16HD","CCTV-16奥林匹克","CCTV16奥林匹克"],"CCTV17":["CCTV-17","CCTV-17HD","CCTV17农业农村","CCTV-17农业农村"],"兵器科技":["CCTV-兵器科技","CCTV兵器科技"],"风云音乐":["CCTV-风云音乐","CCTV风云音乐"],"风云足球":["CCTV-风云足球","CCTV风云足球"],"风云剧场":["CCTV-风云剧场","CCTV风云剧场"],"怀旧剧场":["CCTV-怀旧剧场","CCTV怀旧剧场"],"第一剧场":["CCTV-第一剧场","CCTV第一剧场"],"女性时尚":["CCTV-女性时尚","CCTV女性时尚"],"世界地理":["CCTV-世界地理","CCTV世界地理"],"央视台球":["CCTV-央视台球","CCTV央视台球"],"高尔夫网球":["CCTV-高尔夫网球","CCTV高尔夫网球","CCTV央视高网","CCTV-央视高网","央视高网"],"央视文化精品":["CCTV-央视文化精品","CCTV央视文化精品","CCTV文化精品","CCTV-文化精品","文化精品"],"卫生健康":["CCTV-卫生健康","CCTV卫生健康"],"电视指南":["CCTV-电视指南","CCTV电视指南"],"北京纪实科教":["纪实科教","纪实科教8K","北京纪实"],#卫视频道"山东卫视":["山东卫视HD"],"浙江卫视":["浙江卫视HD"],"江苏卫视":["江苏卫视HD"],"东方卫视":["东方卫视HD"],"深圳卫视":["深圳卫视HD"],"北京卫视":["北京卫视HD"],"广东卫视":["广东卫视HD"],"广西卫视":["广西卫视HD"],"东南卫视":["东南卫视HD"],"海南卫视":["海南卫视HD"],"河北卫视":["河北卫视HD"],"河南卫视":["河南卫视HD"],"湖北卫视":["湖北卫视HD"],"江西卫视":["江西卫视HD"],"四川卫视":["四川卫视HD"],"重庆卫视":["重庆卫视HD"],"贵州卫视":["贵州卫视HD"],"云南卫视":["云南卫视HD"],"天津卫视":["天津卫视HD"],"安徽卫视":["安徽卫视HD"],"湖南卫视":["湖南卫视HD"],"辽宁卫视":["辽宁卫视HD"],"黑龙江卫视":["黑龙江卫视HD","龙江卫视","龙江卫视HD"],"吉林卫视":["吉林卫视HD"],"内蒙古卫视":["内蒙古卫视HD","内蒙卫视","内蒙卫视HD"],"宁夏卫视":["宁夏卫视HD"],"山西卫视":["山西卫视HD"],"陕西卫视":["陕西卫视HD"],"甘肃卫视":["甘肃卫视HD"],"青海卫视":["青海卫视HD"],"新疆卫视":["新疆卫视HD"],"西藏卫视":["西藏卫视HD"],"三沙卫视":["三沙卫视HD"],"厦门卫视":["厦门卫士HD"],"兵团卫视":["兵团卫视HD"],"延边卫视":["延边卫视HD"],"安多卫视":["安多卫视HD"],"康巴卫视":["康巴卫士HD"],"农林卫视":["农林卫视HD"],"山东教育":["山东教育卫视","IPTV山东教育"],"CETV1":["中国教育1台","中国教育一台","中国教育1","CETV-1综合教育","CETV-1"],"CETV2":["中国教育2台","中国教育二台","中国教育2","CETV-2空中课堂","CETV-2"],"CETV3":["中国教育3台","中国教育三台","中国教育3","CETV-3教育服务","CETV-3"],"CETV4":["中国教育4台","中国教育四台","中国教育4","CETV-4职业教育","CETV-4"],"早期教育":["中国教育5台","中国教育5","中国教育五台","CETV早期教育","CETV-早期教育","CETV早期教育","CETV-5","CETV5"],#北京专属频道"北京卫视":["北京卫视HD"],"北京财经":["北京财经HD"],"北京纪实":["北京纪实HD"],"北京生活":["北京生活HD"],"北京体育休闲":["北京体育休闲HD"],"北京国际":["北京国际HD"],"北京文艺":["北京文艺HD"],"北京新闻":["北京新闻HD"],"北京淘电影":["IPTV淘电影","北京IPTV淘电影","淘电影"],"北京淘剧场":["IPTV淘剧场","北京IPTV淘剧场","淘剧场"],"北京淘4K":["IPTV淘4K","北京IPTV淘4K","北京IPTV4K超清","淘4K"],"北京淘娱乐":["IPTV淘娱乐","北京IPTV淘娱乐","淘娱乐"],"北京淘BABY":["IPTV淘BABY","北京IPTV淘BABY","北京淘Baby","IPTV淘baby","IPTV淘Baby","北京IPTV淘baby","北京淘baby"],"北京萌宠TV":["IPTV淘萌宠","北京IPTV淘萌宠","北京淘萌宠"],#山东专属频道"山东卫视":["山东卫视频道","山东卫视HD"],"山东齐鲁":["山东齐鲁频道","齐鲁频道HD"],"山东综艺":["山东综艺频道","山东综艺HD"],"山东少儿":["山东少儿频道","山东少儿频道HD"],"山东生活":["山东生活频道","山东生活频道HD"],"山东新闻":["山东新闻频道","山东新闻频道HD"],"山东国际":["山东国际频道","山东新闻频道HD"],"山东体育":["山东体育频道","山东体育频道HD"],"山东文旅":["山东文旅频道","山东文旅频道HD"],#港澳频道"凤凰中文":["凤凰卫视中文台","凤凰中文台","凤凰卫视中文"],"凤凰资讯":["凤凰卫视资讯台","凤凰资讯台","凤凰咨询","凤凰咨询台","凤凰卫视咨询台","凤凰卫视资讯","凤凰卫视咨询"],"凤凰香港":["凤凰卫视香港台","凤凰卫视香港","凤凰香港"],"凤凰电影":["凤凰卫视电影台","凤凰电影台","凤凰卫视电影","鳳凰衛視電影台","凤凰电影"],#电影频道"CHC动作电影":["CHC动作电影HD"],"CHC家庭影院":["CHC家庭影院HD"],"CHC影迷电影":["CHC高清电影","chc影迷电影","影迷电影","chc高清电影","CHC影迷电影HD"],"淘电影":["IPTV淘电影","北京IPTV淘电影","北京淘电影"],"淘精彩":["IPTV淘精彩","北京IPTV淘精彩","北京淘精彩"],"淘剧场":["IPTV淘剧场","北京IPTV淘剧场","北京淘剧场"],"星空卫视":["星空卫视HD"],"黑莓电影":["黑莓电影HD"],"东北热剧":["NewTV东北热剧","NewTV东北热剧","newtv东北热剧","NEWTV东北热剧","NEWTV东北热剧"],"中国功夫":["NewTV中国功夫","NewTV中国功夫","newtv中国功夫","NEWTV中国功夫","NEWTV中国功夫"],"动作电影":["NewTV动作电影","NewTV动作电影","newtv动作电影","NEWTV动作电影","NEWTV动作电影"],"超级电影":["NewTV超级电影","NewTV超级电影","newtv超级电影","NEWTV超级电影","NEWTV超级电影"],#儿童频道"动漫秀场":["动漫秀场4K","SiTV动漫秀场","SiTV动漫秀场","上海动漫秀场"],"哒啵电竞":["哒啵电竞HD"],"黑莓动画":["黑莓动画HD"],"卡酷少儿":["北京卡酷","卡酷卡通","北京卡酷少儿","卡酷动画"],"金鹰卡通":["金鹰卡通HD"],"优漫卡通":["优漫卡通HD"],"哈哈炫动":["炫动卡通","上海哈哈炫动","哈哈炫动HD"],"嘉佳卡通":["嘉佳卡通HD"],#iHOT频道"iHOT爱喜剧":["iHOT爱喜剧","IHOT爱喜剧","IHOT爱喜剧","ihot爱喜剧","爱喜剧","ihot爱喜剧"],"iHOT爱科幻":["iHOT爱科幻","IHOT爱科幻","IHOT爱科幻","ihot爱科幻","爱科幻","ihot爱科幻"],"iHOT爱院线":["iHOT爱院线","IHOT爱院线","IHOT爱院线","ihot爱院线","ihot爱院线","爱院线"],"iHOT爱悬疑":["iHOT爱悬疑","IHOT爱悬疑","IHOT爱悬疑","ihot爱悬疑","ihot爱悬疑","爱悬疑"],"iHOT爱历史":["iHOT爱历史","IHOT爱历史","IHOT爱历史","ihot爱历史","ihot爱历史","爱历史"],"iHOT爱谍战":["iHOT爱谍战","IHOT爱谍战","IHOT爱谍战","ihot爱谍战","ihot爱谍战","爱谍战"],"iHOT爱旅行":["iHOT爱旅行","IHOT爱旅行","IHOT爱旅行","ihot爱旅行","ihot爱旅行","爱旅行"],"iHOT爱幼教":["iHOT爱幼教","IHOT爱幼教","IHOT爱幼教","ihot爱幼教","ihot爱幼教","爱幼教"],"iHOT爱玩具":["iHOT爱玩具","IHOT爱玩具","IHOT爱玩具","ihot爱玩具","ihot爱玩具","爱玩具"],"iHOT爱体育":["iHOT爱体育","IHOT爱体育","IHOT爱体育","ihot爱体育","ihot爱体育","爱体育"],"iHOT爱赛车":["iHOT爱赛车","IHOT爱赛车","IHOT爱赛车","ihot爱赛车","ihot爱赛车","爱赛车"],"iHOT爱浪漫":["iHOT爱浪漫","IHOT爱浪漫","IHOT爱浪漫","ihot爱浪漫","ihot爱浪漫","爱浪漫"],"iHOT爱奇谈":["iHOT爱奇谈","IHOT爱奇谈","IHOT爱奇谈","ihot爱奇谈","ihot爱奇谈","爱奇谈"],"iHOT爱科学":["iHOT爱科学","IHOT爱科学","IHOT爱科学","ihot爱科学","ihot爱科学","爱科学"],"iHOT爱动漫":["iHOT爱动漫","IHOT爱动漫","IHOT爱动漫","ihot爱动漫","ihot爱动漫","爱动漫"],#综合频道"重温经典":["重温经典HD"],"CHANNEL[V]":["CHANNELV","ChannelV"],"求索纪录":["求索记录","求索纪录4K","求索记录4K","求索纪录4K","求索记录4K"],"求索科学":["求索科学HD"],"求索生活":["求索生活HD"],"求索动物":["求索动物HD"],"睛彩青少":["睛彩青少HD"],"睛彩竞技":["睛彩竞技HD"],"睛彩篮球":["睛彩篮球HD"],"睛彩广场舞":["睛彩广场舞HD"],"金鹰纪实":["湖南金鹰纪实","金鹰记实","金鹰纪实HD"],"快乐垂钓":["快乐垂钓HD"],"茶频道":["茶频道HD"],"军事评论":["NewTV军事评论","NewTV军事评论","newtv军事评论","NEWTV军事评论","NEWTV军事评论"],"军旅剧场":["NewTV军旅剧场","NewTV军旅剧场","newtv军旅剧场","NEWTV军旅剧场","NEWTV军旅剧场"],"乐游":["乐游频道","全纪实","SiTV乐游","SiTV乐游频道","SiTV乐游频道","上海乐游频道"],"生活时尚":["生活时尚4K","SiTV生活时尚","SiTV生活时尚","上海生活时尚"],"都市剧场":["都市剧场4K","SiTV都市剧场","SiTV都市剧场","上海都市剧场"],"欢笑剧场":["欢笑剧场4K","欢笑剧场4K","SiTV欢笑剧场","SiTV欢笑剧场","上海欢笑剧场"],"游戏风云":["游戏风云4K","SiTV游戏风云","SiTV游戏风云","上海游戏风云"],"金色学堂":["金色学堂4K","SiTV金色学堂","SiTV金色学堂"],"法治天地":["法治天地HD","上海法治天地"],"哒啵赛事":["哒啵赛事HD"],#体育频道"天元围棋":["天元围棋HD"],"魅力足球":["魅力足球HD"],"五星体育":["五星体育HD"],"劲爆体育":["劲爆体育HD"],"超级体育":["NewTV超级体育","NewTV超级体育","newtv超级体育","NEWTV超级体育","NEWTV超级体育"],#剧场频道"古装剧场":["NewTV古装剧场","NewTV古装剧场","newtv古装剧场","NEWTV古装剧场","NEWTV古装剧场"],"家庭剧场":["NewTV家庭剧场","NewTV家庭剧场","newtv家庭剧场","NEWTV家庭剧场","NEWTV家庭剧场"],"惊悚悬疑":["NewTV惊悚悬疑","NewTV惊悚悬疑","newtv惊悚悬疑","NEWTV惊悚悬疑","NEWTV惊悚悬疑"],"明星大片":["NewTV明星大片","NewTV明星大片","newtv明星大片","NEWTV明星大片","NEWTV明星大片"],"欢乐剧场":["NewTV欢乐剧场","NewTV欢乐剧场","newtv欢乐剧场","NEWTV欢乐剧场","NEWTV欢乐剧场"],"海外剧场":["NewTV海外剧场","NewTV海外剧场","newtv海外剧场","NEWTV海外剧场","NEWTV海外剧场"],"潮妈辣婆":["NewTV潮妈辣婆","NewTV潮妈辣婆","newtv潮妈辣婆","NEWTV潮妈辣婆","NEWTV潮妈辣婆"],"爱情喜剧":["NewTV爱情喜剧","NewTV爱情喜剧","newtv爱情喜剧","NEWTV爱情喜剧","NEWTV爱情喜剧"],"超级电视剧":["NewTV超级电视剧","NewTV超级电视剧","newtv超级电视剧","NEWTV超级电视剧","NEWTV超级电视剧"],"超级综艺":["NewTV超级综艺","NewTV超级综艺","newtv超级综艺","NEWTV超级综艺","NEWTV超级综艺"],"金牌综艺":["NewTV金牌综艺","NewTV金牌综艺","newtv金牌综艺","NEWTV金牌综艺","NEWTV金牌综艺"],"武搏世界":["NewTV武搏世界","NewTV武搏世界","newtv武搏世界","NEWTV武搏世界","NEWTV武搏世界"],"农业致富":["NewTV农业致富","NewTV农业致富","newtv农业致富","NEWTV农业致富","NEWTV农业致富"],"炫舞未来":["NewTV炫舞未来","NewTV炫舞未来","newtv炫舞未来","NEWTV炫舞未来","NEWTV炫舞未来"],"精品体育":["NewTV精品体育","NewTV精品体育","newtv精品体育","NEWTV精品体育","NEWTV精品体育"],"精品大剧":["NewTV精品大剧","NewTV精品大剧","newtv精品大剧","NEWTV精品大剧","NEWTV精品大剧"],"精品纪录":["NewTV精品纪录","NewTV精品纪录","newtv精品纪录","NEWTV精品纪录","NEWTV精品纪录"],"精品萌宠":["NewTV精品萌宠","NewTV精品萌宠","newtv精品萌宠","NEWTV精品萌宠","NEWTV精品萌宠"],"怡伴健康":["NewTV怡伴健康","NewTV怡伴健康","newtv怡伴健康","NEWTV怡伴健康","NEWTV怡伴健康"],}#创建反向映射：别名->规范名self.alias_to_standard={}forstandard_name,aliasesinself.channel_mapping.items():#规范名本身也是一个有效的名称self.alias_to_standard[standard_name.lower()]=standard_nameforaliasinaliases:self.alias_to_standard[alias.lower()]=standard_name#创建分类映射：规范名->分类self.standard_to_category={}forcategory,channelsinself.channel_categories.items():forchannelinchannels:self.standard_to_category[channel]=category#初始化输出分类（合并一些分类以符合要求）self.output_categories={"4K":[],"央视":[],"卫视":[],"港澳台":[],"影视剧":[],"音乐":[],"体育":[]}#分类合并映射（将详细分类合并到输出分类）self.category_merge_map={"4K":["4K"],"央视":["央视"],"卫视":["卫视","北京专属","山东专属"],"港澳台":["港澳台"],"影视剧":["影视剧","剧场","其他"],"音乐":["音乐"],"体育":["体育","综合"]}#真实数据源列表self.data_sources=[#GitHub上的直播源"https://raw.githubusercontent.com/iptv-org/iptv/master/channels/cn.m3u","https://raw.githubusercontent.com/iptv-org/iptv/master/channels/hk.m3u","https://raw.githubusercontent.com/iptv-org/iptv/master/channels/tw.m3u","https://raw.githubusercontent.com/Free-IPTV/Countries/master/China.m3u","https://raw.githubusercontent.com/EvilCaster/iptv/master/cleaned_iptv.m3u",#其他直播源"https://mirror.ghproxy.com/https://raw.githubusercontent.com/YanG-1989/m3u/main/Gather.m3u","https://fastly.jsdelivr.net/gh/iptv-org/iptv@master/channels/cn.m3u","https://ghproxy.com/https://raw.githubusercontent.com/iptv-org/iptv/master/channels/cn.m3u",#备份源"https://mirror.ghproxy.com/https://raw.githubusercontent.com/guptaharsh2024/iptv/main/iptv.m3u","https://raw.githubusercontent.com/frank007886/TVBox/main/live.txt",#新增更多数据源"https://raw.githubusercontent.com/imDazui/Tvlist-awesome-m3u-m3u8/master/m3u/%E5%9B%BD%E5%86%85%E7%94%B5%E8%A7%86%E5%8F%B0.m3u","https://raw.githubusercontent.com/Kimentanm/aptv/master/m3u/iptv.m3u","https://raw.githubusercontent.com/zhanghongchen/iptv/master/IPTV.m3u",]defnormalize_channel_name(self,channel_name):"""将频道名称标准化为规范名"""name_lower=channel_name.lower()#查找匹配的别名foralias,standardinself.alias_to_standard.items():ifaliasinname_lower:returnstandard#如果没有找到匹配的别名，返回原始名称returnchannel_namedefget_channel_category(self,standard_name):"""获取频道的分类"""returnself.standard_to_category.get(standard_name,None)deffetch_all_sources(self):"""从多个数据源获取直播源"""print(f"开始从{len(self.data_sources)}个数据源收集直播源...")forsource_urlinself.data_sources:try:print(f"正在获取源:{source_url}")headers={'User-Agent':'Mozilla/5.0(WindowsNT10.0;Win64;x64)AppleWebKit/537.36(KHTML,likeGecko)Chrome/91.0.4472.124Safari/537.36'}response=requests.get(source_url,timeout=15,headers=headers)ifresponse.status_code==200:content=response.textprint(f"获取成功，内容长度:{len(content)}字符")self.parse_content(content,source_url)else:print(f"获取源失败，状态码:{response.status_code}")time.sleep(2)#避免请求过于频繁exceptExceptionase:print(f"获取源{source_url}失败:{e}")continuedefparse_content(self,content,source_url):"""解析内容，支持多种格式"""lines=content.split('\n')current_channel={}format_detected=Falsefori,lineinenumerate(lines):line=line.strip()ifnotline:continue#检测M3U格式ifline.startswith('#EXTM3U'):format_detected=Truecontinue#解析EXTINF行ifline.startswith('#EXTINF:'):current_channel=self.parse_extinf_line(line)current_channel['source']=source_urlcontinue#如果是URL行且前面有EXTINFifline.startswith(('http://','https://','rtmp://','rtsp://')):ifcurrent_channel:current_channel['url']=line#标准化频道名称original_name=current_channel['channel_name']standard_name=self.normalize_channel_name(original_name)current_channel['standard_name']=standard_namecurrent_channel['original_name']=original_nameifself.check_quality(current_channel):self.sources.append(current_channel.copy())current_channel={}else:#如果没有EXTINF，尝试从URL推断频道信息self.parse_url_only(line,source_url)continue#尝试解析文本格式：频道名称,URLif','inlineandany(protoinlineforprotoin['http://','https://','rtmp://']):parts=line.split(',',1)iflen(parts)==2andparts[1].startswith(('http://','https://','rtmp://')):channel_name=parts[0].strip()url=parts[1].strip()ifself.is_valid_url(url):#标准化频道名称standard_name=self.normalize_channel_name(channel_name)channel={'channel_name':channel_name,'standard_name':standard_name,'original_name':channel_name,'url':url,'source':source_url,'quality':'unknown'}ifself.check_quality(channel):self.sources.append(channel)ifnotformat_detectedandlen(self.sources)==0:print(f"警告:无法识别{source_url}的格式")defparse_extinf_line(self,line):"""解析EXTINF行"""channel={}#提取tvg-nametvg_name_match=re.search(r'tvg-name="([^"]*)"',line)iftvg_name_match:channel['tvg_name']=tvg_name_match.group(1)else:#如果没有tvg-name，尝试从其他地方提取tvg_name_match=re.search(r'tvg-id="([^"]*)"',line)iftvg_name_match:channel['tvg_name']=tvg_name_match.group(1)#提取group-titlegroup_match=re.search(r'group-title="([^"]*)"',line)ifgroup_match:channel['group_title']=group_match.group(1)#提取频道名称（最后一个逗号后的内容）name_match=re.search(r',([^,]*)$',line)ifname_match:channel['channel_name']=name_match.group(1).strip()else:#如果没有逗号，尝试其他解析方式channel['channel_name']=linereturnchanneldefparse_url_only(self,url,source_url):"""解析只有URL没有频道信息的情况"""ifself.is_valid_url(url):#从URL推断频道名称parsed_url=urlparse(url)domain=parsed_url.netlocpath=parsed_url.path#尝试从路径中提取频道信息channel_name="未知频道"if'/cctv'inpath.lower():channel_name="CCTV频道"elif'/tv'inpath.lower():channel_name="电视频道"elif'live'inpath.lower():channel_name="直播频道"#标准化频道名称standard_name=self.normalize_channel_name(channel_name)channel={'channel_name':channel_name,'standard_name':standard_name,'original_name':channel_name,'url':url,'source':source_url,'quality':'unknown'}ifself.check_quality(channel):self.sources.append(channel)defis_valid_url(self,url):"""检查URL是否有效"""try:parsed=urlparse(url)returnbool(parsed.schemeandparsed.netloc)except:returnFalsedefcheck_quality(self,channel):"""检查频道清晰度是否符合要求"""name=channel['channel_name'].lower()standard_name=channel['standard_name'].lower()#基于名称的简单过滤if'4k'innameor'uhd'innameor'超高清'innameor'4k'instandard_name:channel['quality']='4K'returnTrueelif'1080'innameor'fhd'inname:channel['quality']='1080p'returnTrueelif'高清'innameor'hd'inname:channel['quality']='720p'returnTrueelif'test'innameor'演示'innameor'sample'inname:returnFalse#过滤测试频道#如果没有质量信息，默认接受（后面会进一步过滤）channel['quality']='unknown'returnTruedefcategorize_channels(self):"""将频道按规则分类，使用标准名和分类映射"""#先按详细分类分组detailed_categories={}forcategoryinself.channel_categories.keys():detailed_categories[category]=[]forchannelinself.sources:standard_name=channel['standard_name']category=self.get_channel_category(standard_name)ifcategoryandcategoryindetailed_categories:detailed_categories[category].append(channel)else:#如果没有找到分类，尝试使用关键词匹配self.fallback_categorize(channel,detailed_categories)#合并到输出分类foroutput_cat,source_catsinself.category_merge_map.items():forsource_catinsource_cats:ifsource_catindetailed_categories:self.output_categories[output_cat].extend(detailed_categories[source_cat])deffallback_categorize(self,channel,detailed_categories):"""备用分类方法，用于未映射的频道"""name=channel['standard_name'].lower()if'4k'innameor'uhd'innameor'超高清'inname:detailed_categories["4K"].append(channel)elif'cctv'innameor'央视'innameor'中央'inname:detailed_categories["央视"].append(channel)elif'卫视'inname:detailed_categories["卫视"].append(channel)elifany(keywordinnameforkeywordin['凤凰','翡翠','tvb','澳亚','港澳','香港','澳门','台湾']):detailed_categories["港澳台"].append(channel)elifany(keywordinnameforkeywordin['电影','影院','剧场','影视','movie','iHOT']):detailed_categories["影视剧"].append(channel)elifany(keywordinnameforkeywordin['音乐','mtv','music','演唱会']):detailed_categories["音乐"].append(channel)elifany(keywordinnameforkeywordin['体育','sports','cctv5','运动','nba','足球','篮球']):detailed_categories["体育"].append(channel)deffilter_quality_channels(self):"""过滤出高质量频道"""quality_sources=[]forchannelinself.sources:#优先选择已知清晰度的频道ifchannel['quality']in['4K','1080p','720p']:quality_sources.append(channel)#如果高质量频道不够，添加一些未知质量的频道iflen(quality_sources)<100:unknown_quality=[chforchinself.sourcesifch['quality']=='unknown']#随机选择一些未知质量的频道（但确保总数不超过限制）additional=min(len(unknown_quality),200-len(quality_sources))quality_sources.extend(unknown_quality[:additional])self.sources=quality_sourcesdeflimit_channels_per_group(self):"""限制每个分组的频道数量"""forcategory,channelsinself.output_categories.items():ifnotchannels:print(f"警告:{category}分组没有频道")continue#去重：基于URL去除重复频道unique_channels={}forchannelinchannels:url=channel['url']ifurlnotinunique_channels:unique_channels[url]=channelelse:#如果已有相同URL，选择质量更好的existing=unique_channels[url]ifself.get_quality_score(channel)>self.get_quality_score(existing):unique_channels[url]=channelunique_channel_list=list(unique_channels.values())#按质量排序unique_channel_list.sort(key=lambdax:self.get_quality_score(x),reverse=True)#限制数量：最少10个，最多90个iflen(unique_channel_list)<10:print(f"警告:{category}分组频道数不足10个，当前为{len(unique_channel_list)}个")#尝试从其他源补充self.supplement_channels(category,unique_channel_list)eliflen(unique_channel_list)>90:unique_channel_list=unique_channel_list[:90]self.output_categories[category]=unique_channel_listdefsupplement_channels(self,category,existing_channels):"""补充频道数量不足的分组"""iflen(existing_channels)>=10:return#查找该分类对应的标准频道名standard_channels=[]foroutput_cat,source_catsinself.category_merge_map.items():ifoutput_cat==category:forsource_catinsource_cats:ifsource_catinself.channel_categories:standard_channels.extend(self.channel_categories[source_cat])ifnotstandard_channels:return#从其他数据源查找相关频道backup_sources=["https://raw.githubusercontent.com/iptv-org/iptv/master/channels/cn.m3u","https://raw.githubusercontent.com/iptv-org/iptv/master/channels/hk.m3u","https://raw.githubusercontent.com/iptv-org/iptv/master/channels/tw.m3u",]forsource_urlinbackup_sources:try:response=requests.get(source_url,timeout=10)ifresponse.status_code==200:lines=response.text.split('\n')current_channel={}forlineinlines:line=line.strip()ifline.startswith('#EXTINF:'):current_channel=self.parse_extinf_line(line)current_channel['source']=source_urlelifline.startswith(('http://','https://')):ifcurrent_channel:current_channel['url']=line#标准化频道名称original_name=current_channel['channel_name']standard_name=self.normalize_channel_name(original_name)current_channel['standard_name']=standard_namecurrent_channel['original_name']=original_name#检查是否属于当前分类ifstandard_nameinstandard_channels:#检查是否已存在ifnotany(ch['url']==current_channel['url']forchinexisting_channels):existing_channels.append(current_channel.copy())iflen(existing_channels)>=10:returncurrent_channel={}exceptExceptionase:print(f"补充{category}频道时出错:{e}")continuedefget_quality_score(self,channel):"""获取频道质量评分"""quality_scores={'4K':4,'1080p':3,'720p':2,'unknown':1}returnquality_scores.get(channel['quality'],0)defgenerate_output_file(self):"""生成最终的输出文件"""withopen('tzyauto.txt','w',encoding='utf-8')asf:f.write("#自动生成的直播源文件\n")f.write(f"#更新时间:{datetime.now().strftime('%Y-%m-%d%H:%M:%S')}\n")f.write("#分组格式:频道名称,频道URL,#genre#\n\n")#按指定顺序输出分组category_order=["4K","央视","卫视","港澳台","影视剧","音乐","体育"]forcategoryincategory_order:channels=self.output_categories.get(category,[])ifchannels:f.write(f"\n#{category}频道,#genre#\n")forchannelinchannels:#使用标准化名称输出f.write(f"{channel['standard_name']},{channel['url']}\n")print(f"文件生成完成!共处理{len(self.sources)}个频道")defmain():collector=TVSourceCollector()print("开始收集直播源...")collector.fetch_all_sources()print(f"初步收集到{len(collector.sources)}个频道")print("过滤高质量频道...")collector.filter_quality_channels()print(f"过滤后剩余{len(collector.sources)}个频道")print("开始分类频道...")collector.categorize_channels()print("限制各分组频道数量...")collector.limit_channels_per_group()print("生成输出文件...")collector.generate_output_file()#输出统计信息print("\n===统计信息===")total_channels=0forcategory,channelsincollector.output_categories.items():print(f"{category}:{len(channels)}个频道")total_channels+=len(channels)#质量统计quality_stats={}forchannelincollector.sources:quality=channel['quality']quality_stats[quality]=quality_stats.get(quality,0)+1print(f"\n===质量统计===")forquality,countinquality_stats.items():print(f"{quality}:{count}个频道")print(f"\n总计:{total_channels}个频道")if__name__=="__main__":main()

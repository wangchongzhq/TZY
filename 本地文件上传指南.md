# IPTV 直播源检测工作流 - 本地文件上传指南

## 概述

本指南详细介绍如何将本地IPTV直播源文件上传到GitHub Actions工作流进行远程检测。

## 上传方式

工作流支持三种输入方式，其中**Base64编码**是上传本地文件的主要方式：

### 1. Base64编码上传（推荐用于本地文件）

#### 步骤1：准备Base64编码

**Windows系统：**
```powershell
# 使用PowerShell编码文件
$base64Content = [Convert]::ToBase64String([IO.File]::ReadAllBytes("C:\path\to\your\file.m3u"))

# 输出编码内容到剪贴板
$base64Content | Set-Clipboard
```

**macOS/Linux系统：**
```bash
# 使用base64命令编码文件
base64 your_file.m3u | pbcopy  # macOS（复制到剪贴板）
base64 your_file.m3u > encoded.txt  # Linux（保存到文件）
```

#### 步骤2：触发工作流

1. 进入GitHub仓库的Actions页面
2. 选择"IPTV 直播源检测工作流"
3. 点击"Run workflow"按钮
4. 选择输入类型为 `base64`
5. 在`base64Content`字段粘贴编码后的文件内容
6. 在`originalFileName`字段填写原始文件名（如`my_channels.m3u`）
7. 点击"Run workflow"执行

### 2. 本地路径上传（仅支持仓库内文件）

如果直播源文件已存在于仓库中，可直接使用文件路径：

1. 选择输入类型为 `local`
2. 在`inputFile`字段填写仓库内的文件路径（如`validator/input/my_channels.m3u`）
3. 点击"Run workflow"执行

### 3. URL上传（远程文件）

如果直播源文件已存在于网络上，可直接使用URL：

1. 选择输入类型为 `url`
2. 在`inputFile`字段填写完整的文件URL（如`https://example.com/channels.m3u`）
3. 点击"Run workflow"执行

## 输出文件名规则

无论使用哪种输入方式，验证后的有效直播源文件都会遵循以下命名规则：
- `原始文件名 + _valid + 原始扩展名`
- 示例：`my_channels.m3u` → `my_channels_valid.m3u`

## 工作流执行状态

工作流执行过程中，您可以在Actions页面查看实时日志，了解：
- 文件上传和解码状态
- 频道解析进度
- 直播源验证进度
- 验证结果统计

## 常见问题

### Q: Base64编码后内容太长怎么办？
A: GitHub Actions的输入字段有长度限制（约2MB）。如果文件较大，建议：
1. 将文件拆分为较小的部分分别上传
2. 先将文件上传到网络存储，然后使用URL方式检测

### Q: 如何确认文件上传成功？
A: 在工作流日志中查找"已保存临时文件"的信息，确认文件名和大小正确。

### Q: 输出文件在哪里可以找到？
A: 验证完成后，有效直播源文件会保存在仓库的`validator/output/`目录下，并自动提交到GitHub仓库。

## 示例

以一个名为`iptv_channels.m3u`的本地文件为例：

1. 使用PowerShell编码文件：
```powershell
$base64Content = [Convert]::ToBase64String([IO.File]::ReadAllBytes("C:\Downloads\iptv_channels.m3u"))
$base64Content | Set-Clipboard
```

2. 在GitHub Actions中设置：
   - inputType: `base64`
   - base64Content: 粘贴剪贴板中的Base64内容
   - originalFileName: `iptv_channels.m3u`

3. 执行后，验证结果文件将保存为：`iptv_channels_valid.m3u`

## 注意事项

1. 确保文件编码格式为UTF-8，避免中文乱码
2. 推荐使用.m3u或.txt格式的直播源文件
3. 单次检测的频道数量建议不超过1000个，以避免超时
4. 网络不稳定可能导致验证结果不准确，建议在网络良好时执行

---

**更新日期：** 2024-01-20  
**版本：** v1.0  
**适用工作流：** IPTV 直播源检测工作流 v2.0+
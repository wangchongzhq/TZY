# GitHub Actions 工作流界面使用说明

## 界面字段说明

### 1. 日志级别
- **作用**：控制验证过程中日志输出的详细程度
- **选项**：`info`（默认，基本信息）、`debug`（调试信息）、`warn`（警告信息）
- **使用建议**：一般情况使用默认的`info`即可，需要详细调试信息时选择`debug`

### 2. 输入类型（最重要的选择）
- **作用**：指定您要验证的直播源文件来源
- **三个选项的区别**：

| 输入类型 | 适用场景 | 具体说明 |
|---------|---------|---------|
| **local** | 验证仓库内已存在的文件 | 输入仓库内的文件相对路径（如：`validator/input/channels.m3u`） |
| **url** | 验证网络上的远程文件 | 输入完整的文件URL（如：`https://example.com/channels.m3u`） |
| **base64** | 验证本地电脑上的文件 | 需要将本地文件转换为Base64编码后上传 |

### 3. 要检测的本地文件路径或远程URL
- **适用条件**：当`输入类型`选择为`local`或`url`时必填
- **填写方式**：
  - `local`：填写仓库内的文件相对路径
  - `url`：填写完整的远程文件URL

### 4. Base64编码的本地文件内容
- **适用条件**：当`输入类型`选择为`base64`时必填
- **作用**：用于上传本地电脑上的直播源文件（GitHub Actions不支持直接文件上传，需通过Base64编码）

### 5. 本地文件的原始名称
- **适用条件**：当`输入类型`选择为`base64`时必填
- **作用**：指定上传文件的原始名称（包括扩展名），用于生成正确的输出文件名

## 如何上传本地文件

由于GitHub Actions的限制，workflow_dispatch目前不支持直接的文件上传按钮。要上传本地文件，需要使用`base64`输入类型，并按照以下步骤操作：

### Windows系统操作步骤

1. **打开PowerShell**
2. **编码本地文件**：
   ```powershell
   # 将"C:\path\to\your\channels.m3u"替换为您的文件路径
   $base64Content = [Convert]::ToBase64String([IO.File]::ReadAllBytes("C:\path\to\your\channels.m3u"))
   ```
3. **复制编码内容**：
   ```powershell
   $base64Content | Set-Clipboard
   ```
4. **在工作流界面填写**：
   - 选择`输入类型`为`base64`
   - 将剪贴板中的Base64内容粘贴到`Base64编码的本地文件内容`输入框
   - 在`本地文件的原始名称`中填写您的原始文件名（如：`channels.m3u`）

### macOS/Linux系统操作步骤

1. **打开终端**
2. **编码本地文件**：
   ```bash
   # 将"your_file.m3u"替换为您的文件路径
   base64 your_file.m3u | pbcopy  # macOS（自动复制到剪贴板）
   # 或
   base64 your_file.m3u > encoded.txt  # Linux（保存到文件，需手动复制内容）
   ```
3. **在工作流界面填写**：
   - 选择`输入类型`为`base64`
   - 将编码内容粘贴到`Base64编码的本地文件内容`输入框
   - 在`本地文件的原始名称`中填写您的原始文件名（如：`channels.m3u`）

## 关于文件上传按钮的说明

目前GitHub Actions的workflow_dispatch功能**不支持直接的文件上传按钮**，这是GitHub平台的限制。所有输入都必须通过文本、选择框等方式提供。

我们已经通过Base64编码的方式实现了本地文件上传功能，虽然步骤稍多，但这是当前GitHub Actions支持的唯一方式。

## 常见问题

### Q: 为什么使用Base64上传的文件内容这么长？
A: Base64编码会使文件大小增加约33%，这是正常现象。

### Q: 上传大文件时出现问题怎么办？
A: GitHub Actions的输入字段有大小限制（约2MB）。如果您的文件较大，建议：
1. 将文件拆分为较小的部分分别上传
2. 先将文件上传到网络存储（如GitHub Gist），然后使用`url`输入类型

### Q: 输出文件名是什么？
A: 输出文件名遵循"原文件名+_valid+扩展名"的规则（如：`channels.m3u` → `channels_valid.m3u`）。

## 示例操作流程

以验证本地电脑上的`iptv_channels.m3u`文件为例：

1. 使用PowerShell编码文件：
   ```powershell
   $base64Content = [Convert]::ToBase64String([IO.File]::ReadAllBytes("C:\Downloads\iptv_channels.m3u"))
   $base64Content | Set-Clipboard
   ```

2. 在GitHub Actions界面：
   - 日志级别：保持默认`info`
   - 输入类型：选择`base64`
   - Base64编码的本地文件内容：粘贴剪贴板中的内容
   - 本地文件的原始名称：填写`iptv_channels.m3u`
   - 点击"Run workflow"按钮执行

3. 等待验证完成后，结果文件将保存在仓库的`validator/output/`目录下（如：`iptv_channels_valid.m3u`）。

---

**提示**：如果您经常需要上传本地文件，建议将Base64编码步骤保存为脚本，以便重复使用。
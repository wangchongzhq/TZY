name: 4K超高清直播源自动更新

on:
  # 定时运行：每天凌晨2点执行
  schedule:
    - cron: '0 2 * * *'
  
  # 手动触发
  workflow_dispatch:
    inputs:
      logLevel:
        description: '日志级别'
        required: true
        default: 'info'

jobs:
  update-4k-channels:
    runs-on: ubuntu-latest
    
    steps:
      # 检出代码仓库
      - name: 检出代码
        uses: actions/checkout@v3
      
      # 设置Python环境
      - name: 设置Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'pip'
      
      # 安装依赖（如果需要）
      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          # 如果需要其他依赖，可以在这里安装
          # pip install -r requirements.txt
      
      # 运行脚本更新4K直播源
      - name: 运行4K直播源更新脚本
        run: python process_4k_uhd_hb.py
      
      # 检查输出文件是否生成
      - name: 验证输出文件
        run: |
          if [ -f 4K_uhd_hb.txt ]; then
            echo "✓ 输出文件已成功生成"
            echo "文件内容预览："
            head -n 10 4K_uhd_hb.txt
          else
            echo "✗ 输出文件生成失败"
            exit 1
          fi
      
      # 提交更新后的文件
      - name: 提交更新
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # 检查是否有文件需要提交
          git add 4K_uhd_hb.txt
          git status
          
          # 只有当有更改时才提交
          if git diff --cached --quiet; then
            echo "没有新的更新需要提交"
          else
            git commit -m "自动化更新：更新4K超高清直播源列表 $(date +'%Y-%m-%d')"
            git push
          fi

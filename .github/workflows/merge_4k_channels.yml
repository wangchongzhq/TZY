name: 4K超高清直播源合并更新

on:
  # 每天自动执行一次（UTC时间，可根据需要调整）
  schedule:
    - cron: '0 12 * * *'  # 每天UTC 12:00，即北京时间20:00
  
  # 手动触发选项
  workflow_dispatch:
    inputs:
      logLevel:
        description: '日志级别'
        required: true
        default: 'info'
        type: choice
        options:
          - info
          - debug

jobs:
  merge-4k-channels:
    runs-on: ubuntu-latest
    
    steps:
      # 检出代码仓库
      - name: 检出代码
        uses: actions/checkout@v3
      
      # 设置Python环境
      - name: 设置Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'pip'
      
      # 安装依赖
      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      # 运行4K超高清直播源合并脚本
      - name: 合并4K直播源
        run: |
          python 4K_uhd_merger.py --input-file 4K_uhd_channels.txt --output-file 4K_uhd_hb.txt
      
      # 检查输出文件是否生成
      - name: 验证输出文件
        run: |
          ls -la 4K_uhd_hb.txt
          cat 4K_uhd_hb.txt
      
      # 提交更新的文件（如果有变化）
      - name: 提交更改
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: '自动化更新：4K超高清直播源合并'
          file_pattern: 4K_uhd_hb.txt

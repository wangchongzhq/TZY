<!DOCTYPE html>
<html>
<head>
    <title>简单SocketIO测试</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成，正在初始化SocketIO...');
            
            // 初始化Socket.io连接
            const socket = io('http://localhost:5001');
            
            // 连接事件
            socket.on('connect', function() {
                console.log('SocketIO连接已建立');
                document.getElementById('status').innerHTML = '连接状态: 已连接';
            });
            
            // 连接错误事件
            socket.on('connect_error', function(error) {
                console.error('SocketIO连接错误:', error);
                document.getElementById('status').innerHTML = '连接状态: 连接错误: ' + error.message;
            });
            
            // 断开连接事件
            socket.on('disconnect', function() {
                console.log('SocketIO连接已断开');
                document.getElementById('status').innerHTML = '连接状态: 已断开';
            });
            
            // 验证开始事件
            socket.on('validation_started', function(data) {
                console.log('收到validation_started事件:', data);
                document.getElementById('events').innerHTML += '<p>验证开始: ' + data.message + '</p>';
            });
            
            // 验证错误事件
            socket.on('validation_error', function(data) {
                console.log('收到validation_error事件:', data);
                document.getElementById('events').innerHTML += '<p>验证错误: ' + data.message + '</p>';
            });
            
            // 进度更新事件
            socket.on('validation_progress', function(data) {
                console.log('收到validation_progress事件:', data);
                document.getElementById('events').innerHTML += '<p>进度更新: ' + JSON.stringify(data) + '</p>';
            });
            
            // 验证完成事件
            socket.on('validation_completed', function(data) {
                console.log('收到validation_completed事件:', data);
                document.getElementById('events').innerHTML += '<p>验证完成: ' + JSON.stringify(data) + '</p>';
            });
            
            // 开始验证按钮点击事件
            document.getElementById('start-btn').addEventListener('click', function() {
                console.log('点击了开始验证按钮');
                
                // 禁用开始按钮，启用停止按钮
                document.getElementById('start-btn').setAttribute('disabled', 'disabled');
                document.getElementById('stop-btn').removeAttribute('disabled');
                
                // 发送开始验证事件
                console.log('发送start_validation事件...');
                socket.emit('start_validation', {
                    type: 'url',
                    urls: '测试频道,http://example.com/stream.m3u8',
                    category: '测试',
                    workers: 1,
                    timeout: 1
                });
            });
            
            // 停止验证按钮点击事件
            document.getElementById('stop-btn').addEventListener('click', function() {
                console.log('点击了停止验证按钮');
                
                // 禁用停止按钮，启用开始按钮
                document.getElementById('stop-btn').setAttribute('disabled', 'disabled');
                document.getElementById('start-btn').removeAttribute('disabled');
                
                // 发送停止验证事件
                console.log('发送stop_validation事件...');
                socket.emit('stop_validation');
            });
        });
    </script>
</head>
<body>
    <h1>SocketIO连接和按钮测试</h1>
    <div id="status">连接状态: 正在连接...</div>
    <button id="start-btn">开始验证</button>
    <button id="stop-btn" disabled>停止</button>
    <div id="events">
        <h3>事件日志:</h3>
    </div>
</body>
</html>
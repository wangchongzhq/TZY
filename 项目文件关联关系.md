# 项目文件关联关系分析

## 一、核心配置文件体系

### 1. 配置文件层级关系
```
sources.json → update_sources.py → unified_sources.py
     ↓                 ↓                   ↓
原始配置 → 配置更新工具 → 统一播放源接口
```

### 2. 各配置文件作用

**sources.json**
- 项目的原始配置文件，手工维护
- 包含所有可用直播源的URL、名称和启用状态
- 格式：JSON数组，每个元素包含 `url`、`name`、`enabled` 字段

**update_sources.py**
- 配置更新工具，自动执行
- 读取 `sources.json` 中的启用源
- 生成 `unified_sources.py` 文件
- 可批量更新其他脚本中的播放源引用

**unified_sources.py**
- 由 `update_sources.py` 自动生成，请勿手动修改
- 提供两个核心列表：
  - `UNIFIED_SOURCES`：所有启用的直播源URL列表
  - `SOURCES_WITH_NAMES`：带名称的直播源元组列表
- 作为整个项目的统一播放源接口，被其他脚本导入使用

## 二、功能脚本依赖体系

### 1. 主要功能脚本依赖关系
```
统一配置接口 (unified_sources.py)
        ↑
        ├─ IPTV.py → jieguo.m3u + jieguo.txt
        ├─ tvzy.py → tzydauto.txt
        └─ collect_ipzy.py → ipzy_channels.txt + ipzyauto.txt
```

### 2. 各功能脚本作用

**IPTV.py**
- 全功能IPTV直播源生成工具
- 导入 `unified_sources.UNIFIED_SOURCES` 获取所有直播源
- 支持M3U和TXT两种输出格式
- 生成 `jieguo.m3u` (完整M3U播放列表) 和 `jieguo.txt` (完整TXT播放列表)

**tvzy.py**
- 高质量IPTV直播源生成工具
- 导入 `unified_sources.UNIFIED_SOURCES` 获取所有直播源
- 仅过滤HD/4K高质量频道
- 生成 `tzydauto.txt` (高质量TXT播放列表)

**collect_ipzy.py**
- 特定直播源收集工具
- 导入 `unified_sources.SOURCES_WITH_NAMES` 获取带名称的直播源
- 生成 `ipzyauto.txt` (特定源TXT播放列表)

## 三、辅助工具脚本

### 1. 辅助脚本与核心功能的关系
```
功能脚本 → 辅助脚本 (验证、转换、检查)
   ↓
输出文件
```

### 2. 各辅助脚本作用

**convert_m3u_to_txt.py**
- M3U到TXT格式转换工具
- 读取M3U文件，转换为TXT格式
- 用于GitHub Actions工作流中的格式转换

**check_files.py**
- 输出文件检查工具
- 检查生成的播放列表文件是否存在、大小和修改时间
- 用于验证脚本执行结果

**validate_workflows.py**
- GitHub Actions工作流验证工具
- 检查工作流配置文件的语法和逻辑
- 确保自动化流程正常运行

**test_*.py 文件系列**
- 各种测试工具，用于开发和调试
- 如 `test_local_channels.py` 测试本地频道解析
- 如 `test_file_update.py` 测试文件更新逻辑

## 四、输出文件体系

### 1. 输出文件生成关系
```
功能脚本 → 输出文件 → 用户使用
```

### 2. 各输出文件作用

**jieguo.m3u**
- 由 `IPTV.py` 生成
- 完整的M3U格式IPTV播放列表
- 包含所有可用频道，带分类和EPG信息

**jieguo.txt**
- 由 `IPTV.py` 生成
- 完整的TXT格式IPTV播放列表
- 与 `jieguo.m3u` 内容一致，格式不同

**tzydauto.txt**
- 由 `tvzy.py` 生成
- 高质量TXT格式IPTV播放列表
- 仅包含HD/4K高质量频道

**ipzyauto.txt**
- 由 `collect_ipzy.py` 生成
- 特定来源的TXT格式IPTV播放列表

## 五、自动化工作流体系

### 1. GitHub Actions工作流关系
```
GitHub Actions → 触发脚本执行 → 生成输出文件
   ↓                               ↓
定时/手动触发 → 更新直播源列表 → 部署输出文件
```

### 2. 各工作流作用

`.github/workflows/` 目录下的YML文件定义了多种自动化工作流：

**update_ip-tv.yml** 和 **update_ipzy.yml**
- 定时或手动触发 `IPTV.py` 执行
- 更新 `jieguo.m3u` 和 `jieguo.txt`

**tvzy_update.yml**
- 定时或手动触发 `tvzy.py` 执行
- 更新 `tzydauto.txt`

**Convert M3U to TXT Daily.yml**
- 定时执行 `convert_m3u_to_txt.py`
- 将M3U格式转换为TXT格式

**update_sources.yml**
- 定时或手动触发 `update_sources.py` 执行
- 更新 `unified_sources.py` 配置文件

## 六、完整项目数据流

```
┌─────────────────────────────────────────────────────────────────┐
│                          sources.json                           │
└───────────────────────────┬─────────────────────────────────────┘
                            ↓
┌───────────────────────────┴─────────────────────────────────────┐
│                         update_sources.py                       │
└───────────────────────────┬─────────────────────────────────────┘
                            ↓
┌───────────────────────────┴─────────────────────────────────────┐
│                        unified_sources.py                       │
└──────────┬──────────────────┬──────────────────┬────────────────┘
           ↓                  ↓                  ↓
┌──────────┴─────────┐ ┌──────┴───────────┐ ┌───┴──────────────┐
│       IPTV.py      │ │      tvzy.py     │ │  collect_ipzy.py │
└──────────┬─────────┘ └──────┬───────────┘ └───┬──────────────┘
           ↓                  ↓                  ↓
┌──────────┴─────────┐ ┌──────┴───────────┐ ┌───┴──────────────┐
│jieguo.m3u/jieguo.txt│ │    tzydauto.txt  │ │    ipzyauto.txt  │
└─────────────────────┘ └───────────────────┘ └──────────────────┘
```

## 七、关键依赖关系总结

1. **配置驱动**：所有功能脚本都依赖于 `unified_sources.py` 提供的统一播放源接口
2. **自动生成**：`unified_sources.py` 由 `update_sources.py` 从 `sources.json` 自动生成
3. **输出多样化**：不同功能脚本生成不同格式和内容的输出文件
4. **自动化执行**：GitHub Actions工作流定时或手动触发脚本执行，确保直播源持续更新

## 八、项目架构优势

1. **模块化设计**：配置、功能和辅助工具分离，便于维护和扩展
2. **统一接口**：通过 `unified_sources.py` 提供统一播放源接口，降低脚本间耦合
3. **自动化更新**：通过GitHub Actions实现直播源的定时自动更新
4. **灵活配置**：通过 `sources.json` 可以方便地启用/禁用特定直播源
5. **多样化输出**：支持M3U和TXT格式，满足不同用户需求